## Purpose

This file gives an AI coding agent the minimal, actionable context to be productive in this repository: the high-level architecture, developer workflows, integration points, conventions, and concrete code examples found in this codebase.

## Big Picture

- **Frontend:** `React` + `Vite` app at repository root (run with `npm run dev`). Main UI and data flows live in `src/App.jsx` (single-file app with most business logic) and smaller components in `src/components/`.
- **Backend:** `Express` server in `backend/server.js` using `Prisma` + `SQLite` (schema in `backend/prisma/schema.prisma`). Start with `cd backend && npm run dev`.
- **Auth:** JWT-based. Backend signs tokens with `JWT_SECRET` (env var). Frontend expects a Bearer token in `Authorization` header. Frontend reads `VITE_API_BASE_URL` for API location.

## Key files to open first

- `src/App.jsx` — central UI, data fetching, period helpers (week/month keys), progress handling, and most CRUD flows.
- `src/context/AuthContext.jsx` — auth helper (`login`, `logout`, `authFetch`) and localStorage keys used by contextualized components.
- `backend/server.js` — all API endpoints and server-side business rules (login, users, kpis, progress, backup import/export).
- `backend/prisma/schema.prisma` — models: `User`, `Kpi`, `Progress` (note cascade deletes and unique constraint on progress key triple).
- `backend/prisma/seed.js` and `backend/prisma/migrations/` — DB seeding and migration history.

## Important patterns & conventions (project-specific)

- API base URL: frontend reads `import.meta.env.VITE_API_BASE_URL || 'http://localhost:3000'` — set `VITE_API_BASE_URL` in dev if backend runs elsewhere.
- Auth storage: unified `gt_auth` key (stores `{ user, token }`). Both `src/App.jsx` and `src/context/AuthContext.jsx` use `gt_auth`. When changing auth flows, search for `gt_auth`.
- Progress shape: backend and frontend communicate progress as a map keyed by `${kpiId}-${periodType}-${periodKey}`. Each entry is `{ delivered: boolean, value: string, comment: string }`.
- Period keys:
  - Weekly: `YYYY-Www` (generated by helpers in `src/App.jsx`)
  - Monthly: `YYYY-MM`
- Prisma relationships: `Kpi.ownerId -> User.id` with `onDelete: Cascade`; `Progress` has unique index `@@unique([kpiId, periodType, periodKey])` — deleting Kpi/User cascades progress rows.

## Developer workflows (commands)

- Start frontend (root):

  `npm install` (once)
  `npm run dev` (starts Vite dev server)

- Start backend (separate shell):

  `cd backend`
  `npm install` (once)
  `npm run dev` (starts `node server.js` on `PORT` or `3000`)

- Build frontend for production: `npm run build` (root).
- Lint: `npm run lint` (root) — ESLint config lives in repo root.

## Environment and deployment notes

- Frontend env var: `VITE_API_BASE_URL` (ex: `http://localhost:3000`).
- Backend env var: `JWT_SECRET` to override default `dev-secret-super-simples`.
- Prisma uses SQLite (`file:./dev.db`) by default (see `backend/prisma/schema.prisma`). Migrations are in `backend/prisma/migrations/`.

## API surface (quick reference)

- `POST /api/login` — body: `{ email, password }` -> returns `{ token, user }`.
- `GET /api/users` — auth required, lists users (no password).
- `POST /api/users` — admin-only, create user.
- `GET|POST|PUT|DELETE /api/kpis` — KPI CRUD; `kpi` model fields: `name, description, unitType, periodicity, targetWeekly, targetMonthly, ownerId`.
- `GET|POST /api/progress` — progress map and upsert behavior (see `/backend/server.js`).
- `GET /api/backup/export`, `POST /api/backup/import` — export/import JSON backup (admin-only).

## Concrete code examples (copyable)

- Login (from `src/context/AuthContext.jsx`):

  fetch(`${API_BASE_URL}/api/login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email: String(email).trim(), password })
  })

- Progress POST payload (from `src/App.jsx`):

  {
    kpiId,          // number
    periodType,     // 'semanal' | 'mensal'
    periodKey,      // e.g. '2025-W48' or '2025-12'
    delivered,      // boolean
    value,          // string
    comment         // string
  }

## Notes for contributors / AI agents

- Prefer reading `backend/server.js` when changing API behavior — it encodes validation, HTTP codes, and admin checks.
- Inspect `src/App.jsx` for UI behavior: it contains most business logic (period helpers, KPI performance calculations). Small components in `src/components/` are present but the app remains centralized in `App.jsx`.
- When modifying auth flows, the repository uses a single `localStorage` key: `gt_auth` (object with `{ user, token }`). Update both `App.jsx` and `AuthContext.jsx` together and search for `gt_auth` when making changes.
- No test suite detected — be cautious and verify interactions manually by running frontend + backend locally.

## Where to look next

- `src/App.jsx`, `src/context/AuthContext.jsx`, `backend/server.js`, `backend/prisma/schema.prisma`, `backend/prisma/seed.js`, `backend/prisma/migrations/`.

---
If any part of this summary is unclear or you want the instructions expanded (for example, normalizing auth storage or adding interactive dev scripts), tell me which section and I will update the file.
